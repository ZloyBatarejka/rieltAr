---
description: Общие правила проекта Balivi
globs: 
alwaysApply: true
---

# Проект: Balivi

Система управления арендой недвижимости. Менеджер ведёт учёт аренды объектов собственников, собственник видит свои финансы в личном кабинете.

## Стек

- **Backend:** NestJS, TypeScript, Prisma ORM, PostgreSQL
- **Frontend:** React, TypeScript, Vite, Chakra UI v2, TanStack Table, React Hook Form + zod, MobX, Feature-Sliced Design (FSD)
- **Авторизация:** JWT + bcrypt
- **Язык общения:** русский

## Структура проекта

- `backend/` — NestJS API (порт 8070, префикс `/api`)
- `frontend/` — React SPA (порт 3070)
- `swagger/` — актуальная OpenAPI-спецификация (swagger.json)
- `PLAN.md` — план разработки по фазам
- `TECHNICAL_SPEC.md` — техническое задание

## Swagger / API-контракт

- Backend генерирует OpenAPI-спецификацию через `@nestjs/swagger`
- При изменении API backend **обязан** экспортировать актуальный `swagger/swagger.json`
- Frontend **генерирует** API-клиенты на основе `swagger/swagger.json` (кодогенератор)
- Frontend **не пишет** API-вызовы вручную — только сгенерированные клиенты
- Сгенерированный код: `frontend/src/api/generated/`

## React-компоненты

- Типизация: `React.FC<PropsInterface>` для функциональных компонентов
- Экспорт: `export const ComponentName: React.FC<Props> = (props) => { ... }`
- Props-интерфейс объявлять выше компонента

```tsx
interface PermissionSwitchProps {
  value: boolean
  onChange: (value: boolean) => void
}

export const PermissionSwitch: React.FC<PermissionSwitchProps> = ({
  value,
  onChange,
}) => { ... }
```

## Строгая типизация

- Всегда TypeScript (strict)
- **Запрещён** `any` — всегда конкретный тип
- **Запрещён** `as` (type assertion) — использовать type guard (`value is T`)
- **Не объявлять** явные возвращаемые типы там, где TypeScript выводит их сам. Не писать громоздкие inline-типы (`function foo(): { a: X; b: Y; ... }`).
- Runtime-валидация: на фронте — `zod`, на бэке — type guard или `class-validator`
- Закреплено в ESLint: `no-explicit-any`, `consistent-type-assertions` (без `explicit-function-return-type`)

## Проверка качества кода

После каждого завершённого шага **обязательно** прогонять lint и typecheck:
- Backend: `npm run lint` и `npm run typecheck` (в папке `backend/`)
- Frontend: `npm run lint` и `npm run typecheck` (в папке `frontend/`)
- Шаг считается завершённым только если оба скрипта проходят без ошибок

## Тестирование

- Backend: Jest + supertest — сервисы, бизнес-логику, эндпоинты
- Frontend: Vitest + React Testing Library — формы, авторизацию, критичные компоненты
- Каждый новый модуль/фича — базовые тесты для основных сценариев

## Планирование

- Перед началом работы сверяйся с `PLAN.md`
- `[x]` — шаг выполнен, `[ ]` — ещё не сделан
