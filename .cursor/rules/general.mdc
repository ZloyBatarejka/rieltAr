---
description: Общие правила проекта RieltAr
globs: 
alwaysApply: true
---

# Проект: RieltAr

Система управления арендой недвижимости. Менеджер ведёт учёт аренды объектов собственников, собственник видит свои финансы в личном кабинете.

## Стек

- **Backend:** NestJS, TypeScript, Prisma ORM, PostgreSQL
- **Frontend:** React, TypeScript, Vite, Chakra UI v2, React Hook Form + zod, MobX, Feature-Sliced Design (FSD)
- **Авторизация:** JWT + bcrypt
- **Язык общения:** русский

## Структура проекта

- `backend/` — NestJS API (порт 8070, префикс `/api`)
- `frontend/` — React SPA (порт 3070)
- `swagger/` — актуальная OpenAPI-спецификация (swagger.json)
- `PLAN.md` — план разработки по фазам
- `TECHNICAL_SPEC.md` — техническое задание

## Swagger / API-контракт

- Backend генерирует OpenAPI-спецификацию через `@nestjs/swagger`
- При изменении API backend **обязан** экспортировать актуальный `swagger/swagger.json`
- Frontend **генерирует** API-клиенты на основе `swagger/swagger.json` (кодогенератор)
- Frontend **не пишет** API-вызовы вручную — только сгенерированные клиенты
- Сгенерированный код: `frontend/src/api/generated/`

## Строгая типизация

- Всегда TypeScript (strict)
- **Запрещён** `any` — всегда конкретный тип
- **Запрещён** `as` (type assertion) — использовать type guard (`value is T`)
- **Обязательны** явные возвращаемые типы у функций и методов (кроме callback-выражений и void)
- Runtime-валидация: на фронте — `zod`, на бэке — type guard или `class-validator`
- Закреплено в ESLint: `no-explicit-any`, `consistent-type-assertions`, `explicit-function-return-type`

## Проверка качества кода

После каждого завершённого шага **обязательно** прогонять lint и typecheck:
- Backend: `npm run lint` и `npm run typecheck` (в папке `backend/`)
- Frontend: `npm run lint` и `npm run typecheck` (в папке `frontend/`)
- Шаг считается завершённым только если оба скрипта проходят без ошибок

## Тестирование

- Backend: Jest + supertest — сервисы, бизнес-логику, эндпоинты
- Frontend: Vitest + React Testing Library — формы, авторизацию, критичные компоненты
- Каждый новый модуль/фича — базовые тесты для основных сценариев

## Планирование

- Перед началом работы сверяйся с `PLAN.md`
- `[x]` — шаг выполнен, `[ ]` — ещё не сделан
